<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head.ejs') %>

<body class="details_bg">
  <nav class="navbar sticky-top navbar-expand-lg navbar-light nav-color">
    <a class="navbar-brand" href="/"><img src="https://i.imgur.com/Yunghri.png" alt="logo" /></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse " id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto  ">
        <li class="nav-item active  ">
          <a class="nav-link " href="/"><strong>Blogs</strong> <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/about"><strong>About Me</strong><span class="sr-only">(current)</span></a>
        </li>

        <% if(loginUser){%>
        <li class="nav-item active">
          <a class="nav-link" href="/blogs/create"><strong>CreateBlog</strong> <span
              class="sr-only">(current)</span></a>
        </li>
        <%}%>
  
        <% if(!loginUser){%>
        <li class="nav-item active">
          <a class="nav-link" href="/login"><strong>Login</strong> <span class="sr-only">(current)</span></a>
        </li>
        <%}%>
  
        <!-- <li class="nav-item active">
          <a class="nav-link" href="/register"><strong>Register</strong> <span class="sr-only">(current)</span></a>
        </li> -->
  
        <% if(loginUser){%>
        <li class="nav-item active">
          <a class="nav-link" href="/logout"><strong>LogOut</strong></a>
        </li>
        <%}%> 
      </ul>

    </div>
  </nav>
  <br />
  <% if(loginUser){%>
        <div class="deleteIcon">
          <a class="btn btn-outline-danger w-25 d-flex justify-content-sm-end" data-doc="<%=blog._id%>"
            role="button">Delete</a>
        </div>
        <%}%>
  
  <br />
  <!-- //Carousel images -->
  <%-include('./partials/carousel.ejs') %>
        <br />
        <hr />
        <div class="blogs content mt-5 text-center text-dark container-md">
          <h1 class="display-3 text-primary"><%=blog.title%></h1>
          <div class="details__carousel upload-image" style="background-image: url('<%=blog.image %>')"></div>
          <br />
          <h5><%= blog.description%></h5>
          <h6 class="grey-text">Published at :<%= blog.createdAt%></h6>
          <br />
          <h3><%= blog.body%></h3>
        </div>

        <!-- Footer of the page -->
        <%- include('./partials/footer.ejs') %>

        <script>
          //DELETE function. It 1st take the given element and assign it to variable.then,
          //run the Click EventListener and assign the variable the Endpont('/blogs/:id'), then
          //run fetch method() to request the server to delete the 'Clicked item'

          const remove = document.querySelector("a.btn");
          remove.addEventListener("click", (e) => {
            const endPoint = `/blogs/${remove.dataset.doc}`;
            //doing Ajax request to Server to delete...
            fetch(endPoint, {
                method: "DELETE",
              })
              .then((response) => response
                .json()
              ) //got the responce back from server after deleted the item, and converted it into JSON format.

              .then((data) => {
                window.location.href = data.redirect; // then, redirected the responce(data) to index page.
              })
              .catch((err) => console.log(err));
          });
        </script>
</body>

<%- include('./partials/scriptTag.ejs') %>

</html>